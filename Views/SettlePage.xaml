<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Magidesk.Presentation.Views.SettlePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*" /> <!-- Ticket Summary -->
            <ColumnDefinition Width="24"/>
            <ColumnDefinition Width="1.5*" /> <!-- Actions -->
        </Grid.ColumnDefinitions>

        <!-- Ticket Summary -->
        <StackPanel Grid.Column="0" Spacing="16">
            <StackPanel Spacing="4">
                <TextBlock Text="{x:Bind ViewModel.Title}" Style="{StaticResource TitleTextBlockStyle}" />
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="{x:Bind ViewModel.TicketNumber, Mode=OneWay}" FontWeight="SemiBold" Foreground="Gray"/>
                    <TextBlock Text="â€¢" Foreground="LightGray"/>
                    <TextBlock Text="{x:Bind ViewModel.TableName, Mode=OneWay}" FontWeight="SemiBold" Foreground="Gray"/>
                </StackPanel>
            </StackPanel>
            
            <Border Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="16">
                <StackPanel Spacing="12">
                    <Grid>
                        <TextBlock Text="{Binding Localization[PAY_TotalAmount], Mode=OneWay}" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <TextBlock Text="{x:Bind ViewModel.TotalAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Right" FontWeight="Bold"/>
                    </Grid>
                    
                    <Grid>
                         <TextBlock Text="{Binding Localization[PAY_TaxAmount], Mode=OneWay}"/>
                         <TextBlock Text="{x:Bind ViewModel.TaxAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" HorizontalAlignment="Right"/>
                    </Grid>
                    
                    <MenuFlyoutSeparator />

                    <Grid>
                        <TextBlock Text="{Binding Localization[PAY_PaidAmount], Mode=OneWay}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.PaidAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" HorizontalAlignment="Right" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    </Grid>

                    <Grid>
                        <TextBlock Text="{Binding Localization[PAY_BalanceDue], Mode=OneWay}" Style="{StaticResource TitleTextBlockStyle}" Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock Text="{x:Bind ViewModel.DueAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" Style="{StaticResource TitleTextBlockStyle}" HorizontalAlignment="Right" Foreground="{ThemeResource SystemAccentColor}" FontWeight="Bold"/>
                    </Grid>
                </StackPanel>
            </Border>

            <StackPanel Spacing="8">
                <InfoBar Title="Error" 
                         Message="{x:Bind ViewModel.Error, Mode=OneWay}" 
                         IsOpen="{x:Bind ViewModel.Error, Converter={StaticResource StringToBoolConverter}, Mode=OneWay}" 
                         Severity="Error" />
 
                <InfoBar Title="Status" 
                         Message="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                         IsOpen="{x:Bind ViewModel.StatusMessage, Converter={StaticResource StringToBoolConverter}, Mode=OneWay}" 
                         Severity="Success" />
            </StackPanel>

            <Button Command="{x:Bind ViewModel.CloseCommand}" Content="{Binding Localization[PAY_Cancel], Mode=OneWay}" Height="48" HorizontalAlignment="Stretch" Style="{StaticResource AccentButtonStyle}" Background="DimGray"/>
        </StackPanel>

        <!-- Actions -->
        <Grid Grid.Column="2" RowSpacing="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Display and Toggles -->
            <Grid Grid.Row="0" ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Tender Input Display (Stylized Readout) -->
                <Border Grid.Column="0" 
                        Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" 
                        BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4" 
                        Padding="12,4">
                    <StackPanel>
                        <TextBlock Text="{Binding Localization[PAY_TenderAmount], Mode=OneWay}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock Text="{x:Bind ViewModel.TenderAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}" 
                                 FontSize="36" 
                                 FontWeight="Bold" 
                                 HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>

                <ToggleButton Grid.Column="1" 
                              Content="{Binding Localization[PAY_TaxExempt], Mode=OneWay}" 
                              IsChecked="{x:Bind ViewModel.IsTaxExempt, Mode=OneWay}"
                              Command="{x:Bind ViewModel.ToggleTaxExemptCommand}"
                              Height="60" VerticalAlignment="Bottom"/>
            </Grid>

            <!-- Numpad and Payment Methods -->
            <Grid Grid.Row="1" ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.2*" /> <!-- Numpad -->
                    <ColumnDefinition Width="*" /> <!-- Payment Methods -->
                </Grid.ColumnDefinitions>

                <!-- Numpad -->
                <Grid RowSpacing="8" ColumnSpacing="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Content="7" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="7" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" FontSize="24"/>
                    <Button Content="8" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="8" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Column="1" FontSize="24"/>
                    <Button Content="9" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="9" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Column="2" FontSize="24"/>

                    <Button Content="4" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="4" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="1" FontSize="24"/>
                    <Button Content="5" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="1" Grid.Column="1" FontSize="24"/>
                    <Button Content="6" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="6" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="1" Grid.Column="2" FontSize="24"/>

                    <Button Content="1" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2" FontSize="24"/>
                    <Button Content="2" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2" Grid.Column="1" FontSize="24"/>
                    <Button Content="3" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="3" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2" Grid.Column="2" FontSize="24"/>

                    <Button Content="C" Command="{x:Bind ViewModel.ClearNumpadCommand}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="3" FontSize="24" Background="IndianRed" Foreground="White"/>
                    <Button Content="0" Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="3" Grid.Column="1" FontSize="24"/>
                    <Button Content="." Command="{x:Bind ViewModel.NumpadCommand}" CommandParameter="." HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="3" Grid.Column="2" FontSize="24"/>
                </Grid>

                <!-- Payment Methods -->
                <StackPanel Grid.Column="1" Spacing="12">
                     <Grid ColumnSpacing="8" RowSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Content="TEST WAIT" Command="{x:Bind ViewModel.TestWaitCommand}" Height="48" HorizontalAlignment="Stretch" Background="Orange" Foreground="Black"/>
                        <Button Grid.Column="1" Content="Next $" Command="{x:Bind ViewModel.NextAmountCommand}" Height="48" HorizontalAlignment="Stretch" Background="LightSlateGray" Foreground="White"/>
                        <Button Grid.Column="2" Content="{Binding Localization[PAY_NoSale], Mode=OneWay}" Command="{x:Bind ViewModel.NoSaleCommand}" Height="48" HorizontalAlignment="Stretch" Background="DarkRed" Foreground="White"/>
                        <Button Grid.Column="3" Content="{Binding Localization[PAY_Exact], Mode=OneWay}" Command="{x:Bind ViewModel.ExactAmountCommand}" Height="48" HorizontalAlignment="Stretch" Background="DarkGreen" Foreground="White" IsEnabled="{x:Bind ViewModel.HasDueAmount, Mode=OneWay}"/>
                    </Grid>

                    <!-- F-0043: Quick Cash Buttons -->
                    <Border Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="12">
                        <StackPanel Spacing="8">
                            <TextBlock Text="{Binding Localization[PAY_QuickCash], Mode=OneWay}" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <Grid ColumnSpacing="8" RowSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <Button Content="$1" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="1" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                                <Button Grid.Column="1" Content="$5" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="5" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                                <Button Grid.Column="2" Content="$10" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="10" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                                
                                <Button Grid.Row="1" Content="$20" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="20" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                                <Button Grid.Row="1" Grid.Column="1" Content="$50" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="50" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                                <Button Grid.Row="1" Grid.Column="2" Content="$100" Command="{x:Bind ViewModel.QuickCashCommand}" CommandParameter="100" Height="40" HorizontalAlignment="Stretch" Background="LightGray" Foreground="Black"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <Button Command="{x:Bind ViewModel.ProcessPaymentCommand}" 
                            HorizontalAlignment="Stretch" Height="60" Background="Green" Foreground="White"
                            CommandParameter="Cash">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE8C7;" />
                            <TextBlock Text="{Binding Localization[PAY_Cash], Mode=OneWay}" FontSize="18" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{x:Bind ViewModel.SwipeCardCommand}" 
                            HorizontalAlignment="Stretch" Height="60" Background="RoyalBlue" Foreground="White">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE8C9;" />
                            <TextBlock Text="{Binding Localization[PAY_CreditCard], Mode=OneWay}" FontSize="18" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{x:Bind ViewModel.ProcessPaymentCommand}" 
                            HorizontalAlignment="Stretch" Height="60" Background="Purple" Foreground="White"
                            CommandParameter="GiftCertificate">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xEC14;" />
                            <TextBlock Text="{Binding Localization[PAY_GiftCard], Mode=OneWay}" FontSize="18" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
        
        <!-- Busy Indicator -->
        <Grid Grid.ColumnSpan="3" Background="#80000000" Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressRing IsActive="True" Width="60" Height="60" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Page>
