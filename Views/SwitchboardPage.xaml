<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Magidesk.Presentation.Views.SwitchboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:Magidesk.Presentation.ViewModels"
    xmlns:dtos="using:Magidesk.Application.DTOs"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Quick Access Grid -->
            <RowDefinition Height="Auto"/> <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Text="Quick Actions" Style="{StaticResource TitleTextBlockStyle}" Margin="24,24,0,12"/>

        <!-- Main Switchboard Layout -->
        <Grid Grid.Row="1" Padding="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/> <!-- Open Tickets List (66%) -->
                <ColumnDefinition Width="1*"/> <!-- Action Panel (33%) -->
            </Grid.ColumnDefinitions>

            <!-- Left: Open Tickets List -->
            <Grid Grid.Column="0" Margin="0,0,24,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Text="Open Tickets" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,12"/>
                
                <ListView ItemsSource="{x:Bind ViewModel.OpenTickets, Mode=OneWay}" 
                          SelectedItem="{x:Bind ViewModel.SelectedTicket, Mode=TwoWay}"
                          SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="dtos:TicketDto">
                            <Grid Padding="12" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4" Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/> <!-- ID Badge -->
                                    <ColumnDefinition Width="*"/>    <!-- Details -->
                                    <ColumnDefinition Width="Auto"/> <!-- Total -->
                                </Grid.ColumnDefinitions>
                                
                                <Border Background="{ThemeResource SystemControlHighlightAccentBrush}" CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind TicketNumber}" Foreground="White" FontWeight="Bold"/>
                                </Border>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0">
                                    <TextBlock Text="{x:Bind TableName, TargetNullValue='Take Out'}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind OwnerName}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                                
                                <TextBlock Grid.Column="2" Text="{x:Bind TotalAmount, Mode=OneWay}" FontWeight="Bold" VerticalAlignment="Center" Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <!-- Right: Action Buttons -->
            <ScrollViewer Grid.Column="1">
                <StackPanel Spacing="12">
                    <!-- New Ticket -->
                    <Button Command="{x:Bind ViewModel.NewTicketCommand}" 
                            HorizontalAlignment="Stretch" Height="80" Background="#2E7D32" CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE710;" FontSize="24" Foreground="White" VerticalAlignment="Center"/>
                            <TextBlock Text="New Ticket" Foreground="White" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Edit Ticket -->
                    <Button Command="{x:Bind ViewModel.EditTicketCommand}" 
                            HorizontalAlignment="Stretch" Height="80" Background="#1565C0" CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE70F;" FontSize="24" Foreground="White" VerticalAlignment="Center"/>
                            <TextBlock Text="Edit Selected" Foreground="White" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Tables -->
                    <Button Command="{x:Bind ViewModel.TablesCommand}" 
                            HorizontalAlignment="Stretch" Height="60" CornerRadius="4">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE90E;" FontSize="20"/>
                            <TextBlock Text="Table Map" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Kitchen (KDS) -->
                    <Button Command="{x:Bind ViewModel.KitchenCommand}" 
                            HorizontalAlignment="Stretch" Height="60" CornerRadius="4">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE99A;" FontSize="20"/>
                            <TextBlock Text="Kitchen Display" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Back Office -->
                    <Button Command="{x:Bind ViewModel.BackOfficeCommand}" 
                            HorizontalAlignment="Stretch" Height="80" Background="#4527A0" CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE713;" FontSize="24" Foreground="White" VerticalAlignment="Center"/>
                            <TextBlock Text="Back Office" Foreground="White" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Manager Functions -->
                    <Button Command="{x:Bind ViewModel.ManagerFunctionsCommand}" 
                            HorizontalAlignment="Stretch" Height="60" CornerRadius="4" Margin="0,12,0,0">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE716;" FontSize="20"/>
                            <TextBlock Text="Manager Fn" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                     <!-- Logout -->
                    <Button Command="{x:Bind ViewModel.LogoutCommand}" 
                            HorizontalAlignment="Stretch" Height="60" Background="#C62828" CornerRadius="4">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE7E8;" FontSize="20" Foreground="White"/>
                            <TextBlock Text="Logout" Foreground="White" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Shutdown -->
                    <Button Command="{x:Bind ViewModel.ShutdownCommand}" 
                            HorizontalAlignment="Stretch" Height="60" Background="#424242" CornerRadius="4">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE71A;" FontSize="20" Foreground="White"/>
                            <TextBlock Text="Shutdown" Foreground="White" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Footer / Clock / Info -->
        <Border Grid.Row="2" Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}" Padding="12">
            <StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Right">
                <TextBlock Text="Terminal: 01" VerticalAlignment="Center"/>
                <TextBlock Text="Server: Admin" VerticalAlignment="Center"/>
                <TextBlock Text="Online" Foreground="Green" VerticalAlignment="Center" FontWeight="Bold"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>
